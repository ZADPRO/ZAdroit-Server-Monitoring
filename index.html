<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Status Logs</title>

    <style>
      body {
        font-family: system-ui, sans-serif;
        margin: 2rem;
        background: #fafafa;
      }
      h1 {
        margin-bottom: 1rem;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        box-shadow: 0 2px 4px #0002;
      }
      th,
      td {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #eee;
        text-align: left;
      }
      th {
        background: #f3f4f6;
      }
      tr:last-child td {
        border-bottom: none;
      }
      .up {
        color: #2e7d32;
        font-weight: 600;
      }
      .down {
        color: #d32f2f;
        font-weight: 600;
      }
      @media (max-width: 600px) {
        td:nth-child(3) {
          word-break: break-all;
        }
      }
    </style>
  </head>

  <body>
    <h1>üö¶ API Status Logs (Realtime)</h1>

    <table>
      <thead>
        <tr>
          <th>Time (IST)</th>
          <th>Status</th>
          <th>Error Message</th>
        </tr>
      </thead>
      <tbody id="log-body">
        <!-- rows injected by JS -->
      </tbody>
    </table>

    <!-- ‚úÖ Inject Firebase Config -->
    <script src="/firebase-config.js"></script>

    <!-- ‚úÖ Firebase SDK (modular) -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        onValue,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

      const firebaseConfig = window.FIREBASE_CONFIG;
      if (!firebaseConfig) {
        document.body.innerHTML +=
          "<p style='color:red;'>‚ùå Firebase config not loaded.</p>";
        throw new Error("Missing FIREBASE_CONFIG");
      }

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const tbody = document.getElementById("log-body");

      function buildRow({ time, status, message }) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${time}</td>
          <td class="${status === "up" ? "up" : "down"}">
            ${status === "up" ? "üü¢ UP" : "üî¥ DOWN"}
          </td>
          <td>${message ? message : "-"}</td>
        `;
        return tr;
      }

      onValue(ref(db, "api-status-logs"), (snap) => {
        tbody.textContent = "";
        const rows = [];
        snap.forEach((child) => rows.push(child.val()));
        rows.reverse().forEach((log) => tbody.appendChild(buildRow(log)));
      });
    </script>
  </body>
</html>
